name: NPM Publish

on:
  issues:
    types:
      - opened

jobs:
  npm-publish:
    runs-on: ubuntu-latest
    name: Publish NPM package
    steps:
        - name: Checkout repository
          uses: actions/checkout@v4
  
        - name: Get current package.json version
          if: contains(github.event.issue.labels.*.name, 'npm/publish')
          run: |
            VERSION=$(jq -r .version package.json)
            echo "The current version in package.json is $VERSION"
        
        - name: Get latest published version from NPM
          run: |
              PACKAGE_NAME="holygrail2"
              LATEST_VERSION=$(curl -s "https://registry.npmjs.org/$PACKAGE_NAME" | jq -r '.["dist-tags"].latest')
              echo "The latest published version of $PACKAGE_NAME on NPM is $LATEST_VERSION"
